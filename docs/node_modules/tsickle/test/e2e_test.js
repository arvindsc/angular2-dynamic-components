"use strict";
var fs = require('fs');
var closure = require('google-closure-compiler');
var test_support_1 = require('./test_support');
function checkClosureCompile(jsFiles, externsFiles, done) {
    var startTime = Date.now();
    var total = jsFiles.length;
    if (!total)
        throw new Error('No JS files in ' + JSON.stringify(jsFiles));
    var CLOSURE_COMPILER_OPTS = {
        'checks_only': true,
        'jscomp_error': 'checkTypes',
        'js': jsFiles,
        'externs': externsFiles,
        'language_in': 'ECMASCRIPT6_STRICT',
    };
    var compiler = new closure.compiler(CLOSURE_COMPILER_OPTS);
    compiler.run(function (exitCode, stdout, stderr) {
        console.log('Closure compilation:', total, 'done after', Date.now() - startTime, 'ms');
        if (exitCode !== 0) {
            done(new Error(stderr));
        }
        else {
            done();
        }
    });
}
exports.checkClosureCompile = checkClosureCompile;
describe('golden file tests', function () {
    it('generates correct Closure code', function (done) {
        var tests = test_support_1.goldenTests();
        var goldenJs = (_a = []).concat.apply(_a, tests.map(function (t) { return t.jsPaths; }));
        var externs = tests.map(function (t) { return t.externsPath; }).filter(fs.existsSync);
        checkClosureCompile(goldenJs, externs, done);
        var _a;
    });
});
//# sourceMappingURL=e2e_test.js.map